{% extends 'base.html' %}

{% include 'navbar.html' %}

{% block title %}Logs{% endblock %}

{% block content %}

<table style="width: 100%; border-collapse: collapse; border-radius: 8px; overflow: hidden; box-shadow: 0 2px 8px rgba(0,0,0,0.15); background: #fff;">
    <thead>
        <tr style="background: #1976d2;">
            <th style="width: 20%; text-align: center; padding: 12px; color: #fff;">Acción</th>
            <th style="width: 20%; text-align: center; padding: 12px; color: #fff;">Usuario</th>
            <th style="width: 20%; text-align: center; padding: 12px; color: #fff;">Fecha y hora</th>
            <th style="width: 40%; text-align: center; padding: 12px 24px 12px 24px; color: #fff;">Detalles</th>
        </tr>
    </thead>
    <tbody>
        {% for log in logs %}
        <tr style="border-bottom: 1px solid #1565c0; background: #e3f2fd;">
            <td style="width: 20%; text-align: center; padding: 10px 8px;">{{ log.action_type }}</td>
            <td style="width: 20%; text-align: center; padding: 10px 8px;">{{ log.user }}</td>
            <td style="width: 20%; text-align: center; padding: 10px 8px;">
                {{ log.timestamp[:19] }}
            </td>
            <td style="width: 40%; padding: 10px 24px 10px 24px;">
                <div class="log-details" style="max-height: 100px; overflow-y: auto; max-width: 100%; background: #fffde7; border-radius: 4px; padding: 8px;">
                    {{log.details}}
                </div>
            </td>
        </tr>
        {% endfor %}
    </tbody>
</table>

<div style="display: flex; justify-content: center; margin: 24px 0;">
    <button id="prev-btn" style="margin-right: 12px; padding: 8px 16px; border-radius: 4px; border: none; background: #1976d2; color: #fff; cursor: pointer;">Anterior</button>
    <span id="page-indicator" style="align-self: center; font-weight: bold;"></span>
    <button id="next-btn" style="margin-left: 12px; padding: 8px 16px; border-radius: 4px; border: none; background: #1976d2; color: #fff; cursor: pointer;">Siguiente</button>
</div>

<style>
    table tr + tr {
        border-top: 8px solid transparent;
    }
</style>

<script>
const LOGS_PER_PAGE = 30;
const LOG_COUNT = {{ log_count|int }};
const MAX_PAGE = Math.max(0, Math.ceil(LOG_COUNT / LOGS_PER_PAGE) - 1);
let page = 0;
const pathParts = window.location.pathname.split('/');
const lastPart = pathParts[pathParts.length - 1];
if (lastPart.startsWith('page_number=')) {
    const match = lastPart.match(/^page_number=(\d+)/);
    if (match) {
        page = parseInt(match[1]);
    }
}
const prevBtn = document.getElementById('prev-btn');
const nextBtn = document.getElementById('next-btn');
const pageIndicator = document.getElementById('page-indicator');
pageIndicator.textContent = "Página " + (page + 1);

function goToPage(newPage) {
    if (newPage < 0) newPage = 0;
    if (newPage > MAX_PAGE) newPage = MAX_PAGE;
    window.location.href = `/logs/page_number=${newPage}&logs_per_page=${LOGS_PER_PAGE}`;
}

prevBtn.onclick = function() {
    if(page > 0) goToPage(page - 1);
};
nextBtn.onclick = function() {
    if(page < MAX_PAGE) goToPage(page + 1);
};
</script>

{% endblock %}